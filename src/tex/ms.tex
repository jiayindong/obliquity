% Define document class
\documentclass[twocolumn,times]{aastex631}
\usepackage{showyourwork}
\usepackage{xspace}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{bm}
\usepackage{physics}

\newcommand{\numistar}{62\xspace}
\newcommand{\numall}{161\xspace}

\received{}
\revised{}
\accepted{}

\submitjournal{the AAS Journals}

% Begin!
\begin{document}

% Title
\title{Isotropic Stellar Obliquities of Misaligned Planetary Systems}

\correspondingauthor{Jiayin Dong}
\email{jdong@flatironinstitute.org}

\newcommand{\FlatironCCA}{Center for Computational Astrophysics, Flatiron Institute, 162 Fifth Avenue, New York, NY 10010, USA}

\author[0000-0002-3610-6953]{Jiayin Dong}
\altaffiliation{Flatiron Research Fellow}
\affiliation{\FlatironCCA}

\author[0000-0002-9328-5652]{Dan Foreman-Mackey}
\affiliation{\FlatironCCA}

\author{et al.}

% Abstract with filler text
\begin{abstract}

Many exoplanetary systems are found with high stellar obliquities. We build a hierarchical Bayesian framework to understand how stellar obliquities of misaligned systems are distributed. If stellar obliquities $\psi$ are isotropically distributed, the $\cos{\psi}$ distribution will be uniform, whereas if stellar obliquities have preferred angles, the $\cos{\psi}$ distribution will present concentrations.
We first apply our framework to \numistar systems with both sky-projected stellar obliquity $\lambda$ and stellar inclination $i_\star$ constraints. The $\cos{\psi}$ distribution is clustered near $-0.2$ ($\psi \sim 100\degr$), in agreement with the preponderance of perpendicular planets.
Interestingly, a similar $\cos{\psi}$ distribution could be inferred without using any $i_\star$ measurements, suggesting that the $\psi$ distribution depends mainly on the underlying $\lambda$ distribution.
We then apply the framework to all \numall systems with sky-projected obliquity measurements. Unlike the observed-$i_\star$ sample, the $\cos{\psi}$ is  nearly uniformly distributed for misaligned systems, corresponding to an isotropic distribution of stellar obliquity.
We find the $\lambda$ distribution of the observed-$i_\star$ sample is clustered at $110\degr$, whereas the $\lambda$ distribution of the full sample is nearly uniform. The observed-$i_\star$ sample could be biased because misaligned systems are often found around hot stars; however, hot stars' inclinations are often measured by the gravity-darkening method, which is biased toward detecting perpendicular planets.
We conclude that misaligned planetary systems, mostly Hot Jupiters, have isotropic stellar obliquities. When compared to theoretical predictions, the distribution is best consistency with the scattering of multiple giant planets after their convergent disk migration.
\end{abstract}

% Main body with filler text
\section{Introduction}
\label{sec:intro}

The stellar obliquity $\psi$ describes the angle between a planet's orbital axis $\bf{n}_{\rm orb}$ and its host star's spin axis $\bf{n}_{\star}$.
For any given $\bf{n}_{\rm orb}$ axis, if $\bf{n}_{\star}$ is a random vector with uniform distribution on a three-dimensional sphere, i.e., $\bf{n}_{\star}$ is isotropically distributed, the probability distribution of $\psi$ follows $p_{\psi} \sim \sin{\psi}$. Since $p_{\cos{\psi}} = p_{\psi} \abs{\dv*{\psi}{\cos{\psi}}}$, $p_{\cos{\psi}}$ is uniformly distributed between $-1$ and $1$. If the stellar obliquity is not isotropically distributed but have some preferred angles, the $\cos{\psi}$ distribution will present concentrations at certain values.

In reality, we only measure the sky-projected stellar obliquity $\lambda$, the angle between the projections of $\bf{n}_{\rm orb}$ and $\bf{n}_{\star}$ onto the plane of the sky. Stellar obliquity $\psi$ can be computed as \citep[e.g.,][]{Fabrycky09}:
\begin{equation}\label{eqn:psi}
    \cos{\psi} = \sin{i_\star}\sin{i_{\rm orb}}\cos{\lambda} + \cos{i_\star}\cos{i_{\rm orb}},
\end{equation}
where $i_{\rm orb}$ is the angle between the vector $\bf{n}_{\rm orb}$ and the observer's line of sight, and $i_\star$ is the angle between $\bf{n}_{\star}$ and the observer's line of sight.
Since the sky-projected stellar obliquities can be measured only in transiting exoplanet systems, $i_{\rm orb} \approx 90\degr$ and $\cos{\psi} \approx \sin{i_\star}\cos{\lambda}$.

To constrain the 3D stellar obliquity $\psi$, the measurements of the sky-projected obliquity $\lambda$ and stellar inclination $i_\star$ are required. The stellar inclination can often be constrained via, e.g., photometric and spectroscopic rotational modulation introduced by starspots, gravity darkening, and asteroseismology. For systems without measured $i_\star$, it is still possible to infer the 3D stellar obliquity $\psi$ just from the sky-projected obliquity $\lambda$ assuming the stellar inclination $i_\star$ is isotropically distributed \citep[e.g.,][]{Fabrycky09}.

\cite{Albrecht21} inferred the 3D stellar obliquities of a sample of stars that have both sky-projected stellar obliquity and stellar inclination constraints. They found while the majority of planets have a small $\psi$, misaligned planets have $\psi$ clustered between 80--125$\degr$. Furthermore, the $\cos{\psi}$ distribution of misaligned systems is not uniformly distributed, but clusters near 0, suggesting the stellar spin axis is not isotropically distributed around the planetary orbital axis.

In this work, we build a hierarchical Bayesian framework to constrain the stellar obliquity distribution of exoplanetary systems, particularly of misaligned systems.
In Section~\ref{sec:hbm}, we describe our hierarchical Bayesian framework and show inferred stellar obliquity distributions. 
In Section~\ref{sec:interpretations}, we interpret the results. 
In Section~\ref{sec:discussion}, we discuss the implication of the stellar obliquity distribution for Hot Jupiter origins.

\section{3D Stellar Obliquity Distributions} \label{sec:hbm}
We build a hierarchical Bayesian framework to model the 3D stellar obliquity ($\psi$) distribution of exoplanetary systems. Figure~\ref{fig:graph} shows the probabilistic graphical model. We aim to constrain a set of hyperparameters $\bm{\beta}$ that describe the stellar obliquity $\psi$ distribution. $\bm{\beta}$ is constrained by $N$ individual systems, where each system has $\psi_n$ that is calculated by the sky-projected stellar obliquity $\lambda_n$ and the stellar inclination $i_n$. For simplicity, we approximate $i_{\rm orb}$ to $90\degr$ and use the simplified version of Equation~(\ref{eqn:psi}) to compute $\psi_n$.
The parameter $\theta_{\star, n}$ contains stellar parameters other than $i_\star$, e.g., stellar rotation period and stellar radius, if the information is available.
Obs$_{\star,n}$ describes observations that help to constrain $i_{\star,n}$, such as photometric or spectroscopic time series and the stellar spectra. If the rotational modulation method is used to constrain the stellar inclination, the $i_{\star,n}$ and $\theta_{\star,n}$ are constrained by rotational modulation in photometric or spectroscopic time series and observed sky-projected stellar rotational line broadening $\hat{v}\sin{i_{\star,n}}$ \citep[e.g.,][]{Masuda20}. If the gravity-darkening method is used, the $i_{\star,n}$ is constrained by the anomaly in transit light curves. If asteroseismology is used, the $i_{\star,n}$ is constrained from the periodic variation in the photometric time series.
Lastly, the sky-projected stellar obliquity $\lambda_n$ is constrained by observed $\hat{\lambda}_n$.

\begin{figure}[ht!]
    \script{graph.py}
    \includegraphics[width=\linewidth]{figures/graph.pdf}
    \caption{Hierarchical Bayesian framework to infer the stellar obliquity distribution of exoplanetary systems. The stellar obliquity distribution is described by hyperparameters $\vb*{\beta}$ and constrained by $n_{\rm th}$ system's stellar obliquity $\psi_n$. Each $\psi_n$ is calculated by the system's sky-projected stellar obliquity $\lambda_n$ and stellar inclination $i_{\star, n}$. $\theta_{\star, n}$ contains other information of the star other than $i_{\star, n}$, such as the stellar radius and stellar rotation period. Obs$_{\star,n}$ contains observations of the star, such as the stellar spectral and photometric and/or spectroscopic time series, and $\hat{\lambda}_n$ has the measured sky-projected stellar obliquity.}
    \label{fig:graph}
\end{figure}

For the stellar obliquity distribution, we adopt a two-component mixture Beta distribution with hyperparameters $\bm{\beta} = \{\bm{w},\bm{a},\bm{b}\}$, where each hyperparameter has a dimension of 2. The Beta distribution is flexible to describe both the spike of aligned systems with 3D stellar obliquities close to $0\degr$ and the clustered or broadly distributed systems of misaligned systems.
The probability distribution follows 
\begin{align}
    \cos{\psi} &\sim 2\times\Bigl( w_0 {\rm Beta}(a_0, b_0) + w_1 {\rm Beta}(a_1, b_1)\Bigr)-1.
\end{align}
Since a Beta distribution is defined on the interval $[0, 1]$, we extend its support to $[-1,1]$ using a linear transformation (i.e., $2\times Beta-1$).

The hyperparameter and parameter priors are the following:
\begin{align}
    w_{0,1} &\sim {\rm Dirichlet}(1, 1) \nonumber\\
    a_0 &\sim \mathcal{U}(0, 50) \nonumber\\
    b_0 &\sim \mathcal{U}(0, 1) \nonumber\\
    a_1 &\sim \mathcal{U}(0, 10) \nonumber\\
    b_1 &\sim \mathcal{U}(0, 10) \nonumber\\
    \cos{i}_{\star,n} &\sim \mathcal{U}(0, 1) \nonumber\\
    \lambda_{\star,n} &\sim \mathcal{U}(0, \pi).
\end{align}
We set the hyperpriors such that $a_0$ and $b_0$ will be used to infer the spike of $\cos{\psi}$ near 1, and $a_1$ and $b_1$ infer the distribution of the misaligned population. Doing so will also avoid label switching in our mixture model. The probability distribution of an isotropic $i_{\rm star}$ follows $p_{i_\star} \sim \sin{i_{\star}}$, or $p_{\cos{i_\star}} \sim 1$. The $\lambda$ should be the angle between two random unit vectors on a 2D circle and always between 0 and $\pi$. 

The likelihood functions are the following:
\begin{align}
    L(\lambda) &\sim \prod_{i=1}^N\mathcal{N}(\hat{\lambda}_n, \sigma_{\hat{\lambda}_n}) \nonumber\\
    L(i_\star, \theta_\star) &\sim \prod_{i=1}^N\mathcal{N}({\rm Obs}_{\star,n}, \sigma_{{\rm Obs}_{\star,n}}).
\end{align}

\begin{figure*}[ht!]
    \script{psi_dist.py}
    \begin{centering}
        \includegraphics{figures/psi_dist.pdf}
        \caption{The distributions of the cosine of 3D stellar obliquity $\cos{\psi}$. The left panel presents the inferred $\cos{\psi}$ distribution for the \numistar systems that have both sky-projected stellar obliquity $\lambda$ and stellar inclination $i_\star$ measurements using the statistical model described in Figure~\ref{fig:graph}. The middle panel uses the same sample as the left panel but now removes the likelihood function on $i_\star$. The right panel presents the $\cos{\psi}$ distribution for all \numall systems that have sky-projected stellar obliquity $\lambda$ measurements and has no likelihood function on $i_\star$. The $\cos{\psi}$ distribution for the observed-$i_\star$ are similar, and both show a cluster near $\cos{\psi} = -0.2$, whereas the distribution for all systems does not have such a trend.}
        \label{fig:psi_dist}
    \end{centering}
\end{figure*}

First, we apply the framework to the sample of \numistar systems that have both sky-projected stellar obliquity $\lambda$ and stellar inclination $i_\star$ constraints summarized in the \cite{Albrecht22} review. If the host star's rotation period is available, we use the value along with the stellar radii and $v\sin{i_\star}$ to infer the stellar inclination. Otherwise, we use the reported stellar inclination and uncertainty listed in Table A1 of \cite{Albrecht22}.
The inferred $\cos{\psi}$ distribution is shown in the left panel of Figure~\ref{fig:psi_dist}. The distribution presents a pike at 1, suggesting the majority of exoplanetary systems are well-aligned systems. For misaligned systems, $\cos{\psi}$ presents a cluster near $\cos{\psi} = -0.2$, corresponding to $\psi$ of $100\degr$. The result is consistent with the findings of a preponderance of perpendicular planets in \cite{Albrecht21}.

To test the dependence of $\cos{\psi}$ distribution on $i_\star$ measurements, we apply the model again to the sample of \numistar systems with both constrained $\lambda$ and $i_\star$. However, in this model, we do not use any additional information on $i_\star$ other than applying an isotropic inclination prior to each system. The corresponding probabilistic graphical model is Figure~\ref{fig:graph} but removing all the dashed edges.
The $\cos{\psi}$ distribution of the new model is shown in the middle panel of Figure~\ref{fig:psi_dist}. Interestingly, the overall $\cos{\psi}$ distributions of the two models are very similar, despite the fact that the inferred $\psi$ uncertainty for each system is now greater.
The similarity between the two distributions suggests that, at least for the observed-$i_\star$ sample, the $\cos{\psi}$ distribution mainly depends on the underlying sky-project stellar obliquity $\lambda$ distribution.

Consequently, we apply our model to all \numall exoplanetary systems that have sky-projected stellar obliquity measurements summarized in \cite{Albrecht22}. The result is presented in the right panel of Figure~\ref{fig:psi_dist}. The $\cos{\psi}$ distribution still spikes at 1 but is nearly flat between $-0.75$ and $0.75$ with no significant clustering. The distribution corresponds to an isotropic distribution of $\psi$ from $40\degr$ to $140\degr$.

\section{Interpretations of the \texorpdfstring{$\psi$}{psi} distributions}\label{sec:interpretations}

In this section, we aim to explain the similarity and disparity between the $\cos{\psi}$ distributions presented in Figure~\ref{fig:psi_dist}.

\subsection{Do we need \texorpdfstring{$i_\star$}{istar} to infer the \texorpdfstring{$\psi$}{psi} distribution?}

There is no doubt that $i_\star$ measurement on an individual system improves the constraint on $\psi$. However, are $i_\star$ measurements required to constrain the population $\psi$ distribution? Particularly, the left and middle panels in Figure~\ref{fig:psi_dist} show that without $i_\star$ measurements, a similar level of constraint on the $\cos{\psi}$ distribution can be achieved. We perform some calculations and tests to evaluate the necessity of $i_\star$ constraints.

\begin{figure*}[ht!]
    \script{coord_psi.py}
    \gridline{
        \fig{figures/coord_psi.pdf}{0.45\textwidth}{\vspace*{-1.8cm}(a) The $\{\psi, \theta\}$ coordinate system. The grey circle corresponds to a constant $\psi$ value.}
        \fig{figures/coord_lam.pdf}{0.45\textwidth}{\vspace*{-1.8cm}(b) The $\{\lambda, i_\star\}$ coordinate system. The grey circle corresponds to a constant $i_\star$ value.}
    }
    \vspace*{-1.5cm}
    \caption{Two coordinate systems to describe the stellar spin axis $\bf{n}_{\star}$ and the planet's orbital axis $\bf{n}_{\rm orb}$.}
    \label{fig:coord}
\end{figure*}

Given a certain $\psi$ distribution, the $\lambda$ and $i_\star$ are no longer randomly/isotropically distributed. We first find relations between $\{\psi, \theta\}$ and $\{\lambda, i_\star\}$, where $\theta$ is the azimuthal angle of the stellar spin axis, as shown in Figure~\ref{fig:coord}. We transform $\bf{n}_{\star}$ in two coordinate systems to Cartesian, pair their terms, and get:
\begin{align}
    \sin{\psi}\cos{\theta} = \cos{i_\star}& \nonumber\\
    \sin{\psi}\sin{\theta} = \sin{\lambda}\sin{i_\star}& \nonumber\\
    \cos{\psi} = \cos{\lambda}\sin{i_\star}&.
\end{align}
Thus, $i_\star = \cos[-1](\sin{\psi}\cos{\theta})$ and $\lambda = \tan[-1](\tan{\psi}\sin{\theta})$. 
We could calculate the probability distribution of $i_\star$ or $\lambda$ from the probability distributions of $\psi$ and $\theta$. Since $\psi$ and $\theta$ are independent random variables, it is possible to marginalize over $\theta$ to find a one-on-one relation between $\lambda$ and $\psi$, or even between $i_\star$ and $\psi$.
If the azimuthal angle of the stellar rotation axis $\theta$ is randomly distributed, we could directly infer the $\psi$ distribution from the $\lambda$ distribution or even $i_\star$ distribution.
An analytical solution between $p_\lambda$ and $p_\psi$ can be found in \cite{Fabrycky09}. 
In our Bayesian framework, both $\psi$ and $\theta$ distributions are simultaneously inferred from the $\lambda$ and $i_\star$ distributions. Without any $i_\star$ measurements, the inferred $\theta$ indeed follows a uniform distribution. With $i_\star$ measurements, the inferred $\theta$ still follows a uniform distribution for aligned systems. For misaligned systems, the inferred $\theta$ distribution is similar to the $i_\star$ distribution as the $\psi$ are close to $90\degr$. For these systems, the $\lambda$ are close to $90\degr$ as well, so the $\theta$ angles are no longer important for the inference. Overall, these two reasons explain why the inferred $\cos{\psi}$ distributions are similar in the left and middle panels of Figure~\ref{fig:psi_dist}.
 
We also design some $\cos{\psi}$ distributions and infer their distributions purely from the $\lambda$ distributions. From each distribution of $\cos{\psi}$ and assuming a uniform $\theta$, we randomly generate 200 samples of $i_\star$ and $\lambda$ and assume them as \emph{true} values. We then add some Gaussian noises to \emph{true} $\lambda$ and $i_\star$ to simulate \emph{observed} values. We use the uncertainties of $\sigma_{\lambda} = 8\degr$ and $\sigma_{i_\star} = 10\degr$ which are typical observation uncertainties. Lastly, from the observed values and their uncertainties, we infer the $\cos{\psi}$ distribution of the sample with or without $i_\star$ measurements.
We test four different distributions of $\cos{\psi}$: a uniform distribution $\mathcal{U}(-1,1)$ and three Normal distributions $\mathcal{N}(0,0.2)$, $\mathcal{N}(-0.4,0.2)$, and $\mathcal{N}(0.4,0.2)$.
In all four distributions, we find inferences with or without $i_\star$ are consistent with each other and injected distributions.

In conclusion, the stellar obliquity distribution can be inferred directly from the sky-projected stellar obliquity distribution. A one-on-one relation could be found if we assume the azimuthal angle of the stellar spin axis is uniformly distributed around the planet's orbital axis.

\subsection{The underlying \texorpdfstring{$\lambda$}{lambda} distributions}

It was surprising that the inferred $\cos{\psi}$ distribution of the observed-$i_\star$ sample evidently differs from the $\cos{\psi}$ distribution of the full sample, shown as the middle and right panels of Figure~\ref{fig:psi_dist}. Since both distributions are inferred with no $i_\star$ information, the disparity is likely introduced by the underlying $\lambda$ distribution.

We find the underlying $\lambda$ distributions of the observed-$i_\star$ sample and the full sample by building another hierarchical Bayesian model. We again use a two-component mixture Beta distribution to describe well-aligned and misaligned systems. We extend the Beta distribution support from $[0,1]$ to $[0,\pi]$ by multiplying the distribution by $\pi$ and use the observed $\lambda$ and uncertainties for the likelihoods. Figure~\ref{fig:lam_dist} shows the $\lambda$ distributions of two samples. It clearly shows that in the observed-$i_\star$ sample, misaligned systems are clustered at $\sim 110\degr$, whereas in the full sample, misaligned systems are nearly uniformly distributed. 

\begin{figure*}[ht!]
    \script{lam_dist.py}
    \begin{centering}
        \includegraphics{figures/lam_dist.pdf}
        \caption{The distributions of sky-projected stellar obliquity ($\lambda$) of the \numistar systems that have both sky-projected stellar obliquity $\lambda$ and stellar inclination $i_\star$ measurements (left panel) and all \numall systems that have sky-projected stellar obliquity measurements. The observed-$i_\star$ has a cluster of systems near $110\degr$, whereas such clustering is not found in the all-system distribution.}
        \label{fig:lam_dist}
    \end{centering}
\end{figure*}

One plausible explanation for the disparity between the two distributions is their small sample sizes. In the measured-$i_\star$ sample, only $21$ systems are misaligned  (i.e., $\lambda > 30\degr$), and in the full sample, $51$ systems are misaligned. It is likely that the 21 samples could not yet represent the population $\psi$ distribution. 

Furthermore, the measured-$i_\star$ sample could be biased towards perpendicular planets. Misaligned systems are often found around hot stars. However, to measure the inclinations of hot stars, the most prolific inclination measurement method, the rotational modulation method, is no longer applicable to hot stars due to their lack of starspots. Instead, the gravity-darkening method is often used. The method, however, could be biased since it only detects planets transiting across stellar disks with large brightness variations (i.e., planet crossing the the stellar poles, or perpendicular planets). In the measured-$i_\star$ sample, $6/21$ systems have stellar inclinations constrained via gravity darkening. All six planets are misaligned and have nearly polar orbits: 
KELT-9 ($\lambda = 85 \pm 0.2\degr$),
KELT-17 ($\lambda = 115.9 \pm 4.1 \degr$), 
Kepler-13 ($\lambda = 59.2 \pm 0.1 \degr$), 
MASCARA-1 ($\lambda = 69.5 \pm 3.0 \degr$),
MASCARA-4 ($\lambda = 112.5 \pm 1.6 \degr$), 
and WASP-189 ($\lambda = 89.3 \pm 1.4 \degr$).
The bias introduced by the sample is significant enough to produce the clustering in the $\lambda$ distribution of the observed-$i_\star$ sample.

\subsection{Hyperpriors}
We also test the robustness of $\cos{\psi}$ distribution on different hyperprior choices \citep[see a nice summary in][]{Nagpal22}. We use different hyperprior distributions, including uniform distributions, log uniform distributions and truncated Normal distributions. In all hyperprior distributions, the clustering of perpendicular planets in observed-$i_\star$ sample is found and such clustering is much weaken in the full sample.

\section{Discussion} \label{sec:discussion}
The stellar obliquity distribution of exoplanetary systems can be inferred purely from their sky-projected stellar obliquity distribution. When we apply our framework to all systems with $\lambda$ measurements, we find misaligned systems have nearly isotropic stellar obliquity distribution. We compare the inferred distribution from the observation to the prediction of mutual inclination of different eccentricity excitation mechanisms of Hot Jupiters. It is in best agreement with the outcome of scattering of multiple giant planets after a convergent disk migration \citep{Beague12}.

\bibliography{bib}

\end{document}
